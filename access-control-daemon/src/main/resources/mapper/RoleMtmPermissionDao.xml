<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hhchun.daemon.dao.RolePermissionDao">

    <resultMap type="com.hhchun.daemon.entity.domain.RolePermissionEntity" id="rolePermissionMap">
        <result property="id" column="id"/>
        <result property="del" column="del"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="roleId" column="role_id"/>
        <result property="permissionId" column="permission_id"/>
    </resultMap>
    <select id="getRolePermissionList" resultType="com.hhchun.daemon.entity.vo.RolePermissionVo">
        SELECT
        rp.`id`,
        rp.`create_time`,
        rp.`update_time`,

        r.`id` AS `role_id`,
        r.`symbol` AS `role_symbol`,
        r.`name` AS `role_name`,
        r.`des` AS `role_des`,

        p.`id` AS `permission_id`,
        p.`symbol` AS `permission_symbol`,
        p.`name` AS `permission_name`,
        p.`des` AS `permission_des`,
        p.`subject`AS `permission_subject`,
        p.`category_id` AS `permission_category_id`,
        pc.`name` AS `permission_category_name`
        FROM `ac_role_mtm_permission` AS rp
        LEFT JOIN `ac_role` AS r ON rp.`role_id`= r.`id`
        LEFT JOIN `ac_permission` AS p ON rp.`permission_id` = p.`id`
        LEFT JOIN `ac_permission_category` AS pc ON p.`category_id` = pc.`id`
        <where>
            <if test="search.roleId != null">
                AND rp.`role_id` = #{search.roleId}
            </if>
            <if test="search.permissionId != null">
                AND rp.`permission_id` = #{search.permissionId}
            </if>
        </where>
        ORDER BY rp.`create_time` DESC
    </select>


</mapper>