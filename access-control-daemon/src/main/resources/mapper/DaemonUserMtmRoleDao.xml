<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hhchun.daemon.dao.DaemonUserRoleDao">

    <resultMap type="com.hhchun.daemon.entity.domain.DaemonUserRoleEntity" id="daemonUserRoleMap">
        <result property="id" column="id"/>
        <result property="del" column="del"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="daemonUserId" column="daemon_user_id"/>
        <result property="roleId" column="role_id"/>
    </resultMap>

    <select id="getDaemonUserRoleList" resultType="com.hhchun.daemon.entity.vo.DaemonUserRoleVo">
        SELECT dr.id, dr.create_time, dr.update_time,
        d.id AS daemon_user_id, d.openid, d.avatar,d.nick_name,
        r.id AS role_id, r.symbol AS role_symbol, r.name AS role_name,
        r.des AS role_des
        FROM ac_daemon_user_mtm_role AS dr
        LEFT JOIN ac_daemon_user AS d ON dr.daemon_user_id = d.id
        LEFT JOIN ac_role AS r ON dr.role_id = r.id
        <where>
            <if test="search.daemonUserId != null">
                AND dr.daemon_user_id = #{search.daemonUserId}
            </if>
            <if test="search.daemonUserId != null">
                AND dr.role_id = #{search.roleId}
            </if>
        </where>
        ORDER BY dr.create_time DESC
    </select>


</mapper>